// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

enum Role {
    ADMIN
    MEMBER
}

enum PlanType {
    SMALL
    LARGE
}

model Plan {
    id            Int            @id @default(autoincrement())
    name          String
    type          PlanType
    minRevenue    Float
    maxRevenue    Float
    link          String
    description   String?
    users         User[]
    subscriptions Subscription[]
}

model User {
    id                  Int           @id @default(autoincrement())
    lastName            String
    firstName           String
    postCode            String
    country             String
    city                String
    email               String        @unique
    phoneNumber         String
    profile             String?       @db.VarChar(255)
    bio                 String?
    linkedInUrl         String
    jobTitle            String
    companyName         String
    commercialName      String
    companyCountry      String
    companyCity         String
    companyPostCode     String
    companyWebsite      String
    companyLinkedInPage String
    companyPhoneNumber  String
    revenue             Float
    revenueFileUrl      String        @db.VarChar(255)
    isValidatedByAdmin  Boolean       @default(false)
    password            String?
    isNew               Boolean       @default(true)
    plan                Plan?         @relation(fields: [planId], references: [id])
    customerId          String?       @unique
    subscription        Subscription?

    role      Role     @default(MEMBER)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    subscriptionId Int?
    planId         Int?

    @@index([email], map: "idx_user_email")
}

model Subscription {
    id     Int @id @default(autoincrement())
    userId Int @unique
    planId Int

    startDate DateTime @default(now())
    endDate   DateTime

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user User @relation(fields: [userId], references: [id])
    plan Plan @relation(fields: [planId], references: [id])

    @@index([userId, planId], map: "idx_subscription_user_plan")
}

model Theme {
    id          Int      @id @default(autoincrement())
    title       String   @db.VarChar(255)
    description String?  @db.Text
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
    Topic       Topic[]

    @@map("themes")
}

enum TopicType {
    COMMUNAUTE
    EVENEMENT
    GUIDE
    QUESTION
    MODELE
    ARTICLES
    ANNONCE
}

enum TopicStatus {
    DRAFT
    PUBLISHED
}

model Topic {
    id        Int         @id @default(autoincrement())
    title     String      @db.VarChar(255)
    content   String      @db.Text
    type      TopicType
    status    TopicStatus @default(DRAFT)
    themeId   Int
    theme     Theme       @relation(fields: [themeId], references: [id])
    createdAt DateTime    @default(now())
    updatedAt DateTime    @updatedAt

    @@index([themeId], map: "idx_topic_theme")
    @@map("topics")
}
